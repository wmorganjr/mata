<html>
<head>
<title>
</title>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
function data() {
  return {
    "flop": $('#flop input').val(),
    "player-1": $('#player-1 input').val(),
    "player-2": $('#player-2 input').val(),
    "player-3": $('#player-3 input').val(),
    "player-4": $('#player-4 input').val(),
    "dead": $('#dead input').val(),
    "trials": $('#trials').val()
  };
}

function fillWinners(equity, chop) {
  $.each(["player-1", "player-2", "player-3", "player-4"], function(idx, k) {
    $("#" + k + " .equity").text(equity[k]);
  });

  $("#chop .equity").text(chop);
}

$(function() {
  $('#go').click(function() {
    var href = "singleHand.html?";
    $.each(data(), function(k, v) {
      href += k + "=" + encodeURIComponent(v) + "&"
    });
    $("#simulator").html("<a href='" + href + "'>Hand-by-hand simulator</a>");

    $('#message').text("Submitting request...");
    $.getJSON("/big", data(), function(resp) {
      if (resp.error) {
        $('#message').text("There was an error on the server. Try a different query and see if that fixes it. Otherwise, contact Will with this timestamp: " + resp.error);
      } else {
        $('#message').text("Request complete. " + resp.trials + " trials run in " + resp.time + " milliseconds.");
        $(".equity").text("");
        $(".chop").text("");
        fillWinners(resp.equity, resp.chop);
      }
    });
  });
});
</script>
</head>
<body>
<h1>Equity Calculator</h1>
<table>
<tr id='flop'>
<td>Flop:</td><td><input /></td>
</tr>
<tr id='player-1'>
<td>Player 1:</td><td><input /></td><td class='equity'></td><td class='chop'></td>
</tr>
<tr id='player-2'>
<td>Player 2:</td><td><input /></td><td class='equity'></td><td class='chop'></td>
</tr>
<tr id='player-3'>
<td>Player 3:</td><td><input /></td><td class='equity'></td><td class='chop'></td>
</tr>
<tr id='player-4'>
<td>Player 4:</td><td><input /></td><td class='equity'></td><td class='chop'></td>
</tr>
<tr id='dead'>
<td>Dead:</td><td><input /></td>
</tr>
<tr id='chop'>
<td>Chop:</td><td class='equity'></td>
</tr>
</table>
<select id='trials'>
  <option>1000</option>
  <option>5000</option>
  <option>10000</option>
  <option>50000</option>
</select>
<input type='submit' id='go' />
<p id='simulator'></p>
<p id='message'></p>
<pre>
The following hands and ranges are supported:
Ks       The King of Spades
K        any King
T+       any Ten, Jack, Queen, King or Ace
K,Q,J    any King, Queen or Jack
*        any random card
</pre>
</body>
</html>
